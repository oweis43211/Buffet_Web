<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام البوفيه</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- زر لوحة التحكم (للمسؤول فقط) -->
    <div id="adminBtn" class="admin-btn">
        <i class="fas fa-cog"></i>
    </div>

    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="screen">
        <div class="login-container">
            <div class="app-header">
                <h1><i class="fas fa-utensils"></i> نظام البوفيه الذكي</h1>
                <p>نظام طلبات الطعام والمشروبات</p>
            </div>

            <div class="login-form">
                <h2><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</h2>
                
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> اسم المستخدم:</label>
                    <input type="text" id="username" placeholder="أدخل اسم المستخدم">
                </div>

                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> كلمة المرور:</label>
                    <input type="password" id="password" placeholder="أدخل كلمة المرور (4 أرقام)">
                </div>

                <button id="loginBtn" class="btn-primary">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
                <button id="changePasswordBtn" class="btn-secondary">
                    <i class="fas fa-key"></i> تغيير كلمة المرور
                </button>

                <div id="loginMessage" class="message"></div>
            </div>

            <div class="footer">
                <p>تم التطوير من قبل: أويس محمد</p>
                <p class="system-status">
                    <span id="systemStatusText">جاري تحميل حالة النظام...</span>
                </p>
            </div>
        </div>
    </div>

    <!-- شاشة التطبيق الرئيسية -->
    <div id="mainScreen" class="screen hidden">
        <div class="app-container">

            <!-- شريط العنوان -->
            <header class="app-header">
                <div class="header-content">
                    <h1><i class="fas fa-utensils"></i> نظام البوفيه الذكي</h1>
                    <div class="user-info">
                        <span id="userName">المستخدم</span>
                        <button id="logoutBtn" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                        </button>
                    </div>
                </div>

                <div class="system-info">
                    <div class="status-item">
                        <i class="fas fa-store"></i> <span id="buffetStatus">جاري التحميل...</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-clock"></i> <span id="lastUpdate">آخر تحديث: --:--:--</span>
                    </div>
                </div>
            </header>

            <!-- المحتوى الرئيسي -->
            <main class="main-content">

                <!-- قسم الطلب -->
                <div class="order-section">
                    <div class="section-header">
                        <h2><i class="fas fa-shopping-cart"></i> طلب جديد</h2>
                    </div>

                    <div class="order-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="place"><i class="fas fa-map-marker-alt"></i> مكانك:</label>
                                <input type="text" id="place" placeholder="الغرفة / المكتب">
                            </div>

                            <div class="form-group">
                                <label for="note"><i class="fas fa-sticky-note"></i> ملاحظة (اختياري):</label>
                                <textarea id="note" rows="2" placeholder="ملاحظات إضافية للطلب..."></textarea>
                            </div>
                        </div>

                        <div class="cart-summary">
                            <h3><i class="fas fa-shopping-basket"></i> سلة المشتريات</h3>
                            <div id="cartItems" class="cart-items">
                                <p class="empty-cart">السلة فارغة</p>
                            </div>
                            <div class="cart-total">
                                <span>المجموع:</span> <span id="cartTotal">0.00 جنيه</span>
                            </div>
                            <div class="cart-actions">
                                <button id="clearCartBtn" class="btn-secondary">
                                    <i class="fas fa-trash"></i> إفراغ السلة
                                </button>
                                <button id="sendOrderBtn" class="btn-primary">
                                    <i class="fas fa-paper-plane"></i> إرسال الطلب (عادي)
                                </button>
                                <button id="sendCashOrderBtn" class="btn-cash">
                                    <i class="fas fa-money-bill-wave"></i> إرسال الطلب (كاش)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- قسم المنتجات -->
                <div class="products-section">
                    <div class="section-header">
                        <h2><i class="fas fa-boxes"></i> المنتجات المتاحة</h2>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="productSearch" placeholder="البحث عن منتج...">
                        </div>
                    </div>

                    <!-- تصنيفات المنتجات -->
                    <div class="category-tabs">
                        <button class="tab-btn active" data-category="all">كل المنتجات</button>
                        <button class="tab-btn" data-category="drinks">المشروبات</button>
                        <button class="tab-btn" data-category="foods">المأكولات</button>
                    </div>

                    <!-- قائمة المنتجات -->
                    <div id="productsGrid" class="products-grid">
                        <div class="loading">جاري تحميل المنتجات...</div>
                    </div>
                </div>

                <!-- قسم الإحصائيات -->
                <div class="stats-section">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-bar"></i> الإحصائيات الشخصية</h2>
                    </div>

                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-history"></i></div>
                            <div class="stat-info">
                                <h3>طلباتي</h3>
                                <p id="myOrdersCount">0</p>
                            </div>
                            <button id="viewOrdersBtn" class="btn-small">
                                <i class="fas fa-eye"></i> عرض
                            </button>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-money-bill"></i></div>
                            <div class="stat-info">
                                <h3>مجموع مشترياتي</h3>
                                <p id="myTotalSpent">0 جنيه</p>
                            </div>
                            <button id="viewConsumptionBtn" class="btn-small">
                                <i class="fas fa-chart-pie"></i> تفاصيل
                            </button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- نافذة اختيار المنتجات -->
    <div id="productSelectorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-box-open"></i> اختيار المنتجات</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="selectorProductsGrid" class="products-grid detailed-view">
                    <!-- سيتم تعبئتها بواسطة JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmSelectionBtn" class="btn-primary">
                    <i class="fas fa-check"></i> تأكيد الاختيار
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة الطلبات السابقة -->
    <div id="ordersModal" class="modal hidden">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <h2><i class="fas fa-clipboard-list"></i> طلباتي السابقة</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>رقم الطلب</th>
                            <th>التاريخ</th>
                            <th>المنتجات</th>
                            <th>الإجمالي</th>
                            <th>الحالة</th>
                            <th>نوع الدفع</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- سيتم تعبئتها بواسطة JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- نافذة الاستهلاك -->
    <div id="consumptionModal" class="modal hidden">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <h2><i class="fas fa-chart-line"></i> تفاصيل الاستهلاك</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="consumption-summary">
                    <div class="summary-card">
                        <h3>المجموع الكلي</h3>
                        <p id="totalAll">0.00 جنيه</p>
                    </div>
                    <div class="summary-card">
                        <h3>الدفع العادي</h3>
                        <p id="totalNormal">0.00 جنيه</p>
                    </div>
                    <div class="summary-card">
                        <h3>الدفع كاش</h3>
                        <p id="totalCash">0.00 جنيه</p>
                    </div>
                </div>

                <table id="consumptionTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>الصنف</th>
                            <th>الكمية</th>
                            <th>السعر</th>
                            <th>الإجمالي</th>
                            <th>نوع الدفع</th>
                        </tr>
                    </thead>
                    <tbody id="consumptionTableBody">
                        <!-- سيتم تعبئتها بواسطة JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- نافذة تغيير كلمة المرور -->
    <div id="changePasswordModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> تغيير كلمة المرور</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="changeUsername">اسم المستخدم:</label>
                    <input type="text" id="changeUsername" placeholder="اسم المستخدم الحالي">
                </div>
                <div class="form-group">
                    <label for="oldPassword">كلمة المرور الحالية:</label>
                    <input type="password" id="oldPassword" placeholder="كلمة المرور القديمة">
                </div>
                <div class="form-group">
                    <label for="newPassword">كلمة المرور الجديدة:</label>
                    <input type="password" id="newPassword" placeholder="4 أرقام فقط">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">تأكيد كلمة المرور:</label>
                    <input type="password" id="confirmPassword" placeholder="تأكيد الرقم السري">
                </div>
                <div id="changePasswordMessage" class="message"></div>
            </div>
            <div class="modal-footer">
                <button id="savePasswordBtn" class="btn-primary">
                    <i class="fas fa-save"></i> حفظ التغييرات
                </button>
            </div>
        </div>
    </div>

    <!-- إشعارات -->
    <div id="notificationArea" class="notification-area"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>
