<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙˆÙÙŠÙ‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #00bfa6;
            --secondary-color: #0078d7;
            --success-color: #F5276C;
            --warning-color: #f2a900;
            --info-color: #00bfa6;
            --dark-bg: #1e1e1e;
            --darker-bg: #1b1b1b;
            --card-bg: #2a2a2a;
            --text-light: #ffffff;
            --text-gray: #cccccc;
            --border-color: #333333;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--dark-bg);
            color: var(--text-light);
            direction: rtl;
            line-height: 1.6;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - ÙƒÙ…Ø§ ÙƒØ§Ù†Øª */
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: #2a2a2a;
            border-radius: 10px;
            text-align: center;
        }

        .login-container h1 {
            margin-bottom: 30px;
            color: white;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: white;
            font-size: 1rem;
        }

        input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: #f2f2f2;
            color: #2b2b2b;
            font-size: 14px;
        }

        .btn {
            background: #00bfa6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            width: 100%;
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: #00bfa6;
        }

        .btn-secondary {
            background: #0078d7;
            font-size: 12px;
        }

        .btn-success {
            background: #F5276C;
        }

        .btn-warning {
            background: #f2a900;
        }

        .btn-info {
            background: #00bfa6;
        }

        /* Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        .btn-extra-large {
            padding: 20px !important;
            font-size: 1.3rem !important;
            font-weight: bold;
            margin: 10px 0 !important;
            border-radius: 10px !important;
        }

        .footer {
            margin-top: 20px;
            padding: 10px;
            background: #e7e7e7;
            color: black;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .app-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .user-welcome {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }

        .refresh-status {
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        .main-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
        }

        .selected-products {
            padding: 10px;
            background: var(--darker-bg);
            border-radius: 5px;
            margin: 10px 0;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border: 2px dashed var(--border-color);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        .order-buttons-large {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            background: var(--dark-bg);
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }

        .large-modal {
            max-width: 800px;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            color: var(--text-light);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-gray);
        }

        .close:hover {
            color: var(--text-light);
        }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            padding: 12px;
            background: var(--darker-bg);
            border-radius: 8px;
        }

        .note {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .quote {
            color: var(--primary-color);
            font-style: italic;
            font-size: 0.8rem;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .product-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .product-image-container {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--darker-bg);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hidden {
            display: none !important;
        }

        .no-image {
            color: #666;
            font-size: 2.5rem;
        }

        .product-info {
            text-align: right;
        }

        .product-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--text-light);
        }

        .product-info p {
            color: var(--text-gray);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .price {
            color: #4ecdc4 !important;
            font-weight: bold;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }

        .quantity-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: var(--success-color);
            transform: scale(1.1);
        }

        .quantity-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .quantity-display {
            font-size: 1.2rem;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            color: var(--text-light);
        }

        /* Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--darker-bg);
            color: var(--text-light);
            font-weight: bold;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .data-summary {
            background: var(--darker-bg);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .login-container {
                margin: 20px auto;
                padding: 20px;
            }

            .modal-content {
                margin: 2% auto;
                width: 95%;
                max-height: 90vh;
            }

            .products-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .product-card {
                padding: 12px;
            }

            .product-image-container {
                height: 140px;
            }

            .btn-extra-large {
                padding: 18px !important;
                font-size: 1.2rem !important;
            }

            .data-table th, .data-table td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .login-container {
                margin: 10px auto;
                padding: 15px;
            }

            .login-container h1 {
                font-size: 1.3rem;
            }

            input {
                padding: 10px;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .btn-extra-large {
                padding: 16px !important;
                font-size: 1.1rem !important;
            }

            .quantity-btn {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .quantity-display {
                font-size: 1.1rem;
                min-width: 35px;
            }
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: var(--darker-bg);
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--success-color);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login-page" class="page active">
            <div class="login-container">
                <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡</h1>
                
                <div class="form-group">
                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                    <input type="text" id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>

                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                    <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (4 Ø£Ø±Ù‚Ø§Ù…)">
                </div>

                <button id="login-btn" class="btn btn-primary">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button id="change-password-btn" class="btn btn-secondary">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

                <div class="footer">
                    ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ù…Ù† Ù‚Ø¨Ù„ Ø£ÙˆÙŠØ³
                </div>
            </div>
        </div>

        <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="main-page" class="page">
            <div class="container">
                <header class="app-header">
                    <h2 id="welcome-user" class="user-welcome"></h2>
                    <div id="refresh-status" class="refresh-status">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </header>

                <main class="main-content">
                    <div class="form-group">
                        <label for="place">ğŸ“ Ù…ÙƒØ§Ù†Ùƒ:</label>
                        <input type="text" id="place" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙƒØ§Ù†Ùƒ">
                    </div>

                    <div class="form-group">
                        <label for="note">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                        <input type="text" id="note" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>

                    <div class="form-group">
                        <label>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</label>
                        <div id="selected-products" class="selected-products">
                            Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬Ø§Øª
                        </div>
                        <button id="select-products-btn" class="btn btn-primary">ğŸ” Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                    </div>

                    <div class="actions-grid">
                        <button id="consumption-btn" class="btn btn-info">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</button>
                        <button id="orders-btn" class="btn btn-info">ğŸ“‹ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</button>
                    </div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© -->
                    <div class="order-buttons-large">
                        <button id="send-normal-btn" class="btn btn-success btn-extra-large">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ (Ø¹Ø§Ø¯ÙŠ)</button>
                        <button id="send-cash-btn" class="btn btn-warning btn-extra-large">ğŸ’° Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ (ÙƒØ§Ø´)</button>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="products-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                <span class="close">&times;</span>
            </div>
            <div class="search-container">
                <input type="text" id="product-search" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            </div>
            <div class="modal-body">
                <div class="search-info">
                    <span class="note">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØªÙ‡Ø§ âœ…</span>
                    <span class="quote">ÙƒÙÙ„ÙÙˆØ§ ÙˆÙØ§Ø´Ù’Ø±ÙØ¨ÙÙˆØ§ ÙˆÙÙ„ÙØ§ ØªÙØ³Ù’Ø±ÙÙÙÙˆØ§ Ø¥ÙÙ†Ù‘ÙÙ‡Ù Ù„ÙØ§ ÙŠÙØ­ÙØ¨Ù‘Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ø±ÙÙÙÙŠÙ†Ù</span>
                </div>
                <div id="products-list" class="products-grid"></div>
            </div>
            <div class="modal-footer">
                <button id="confirm-selection" class="btn btn-success">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="change-username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                    <input type="text" id="change-username">
                </div>
                <div class="form-group">
                    <label for="old-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                    <input type="password" id="old-password">
                </div>
                <div class="form-group">
                    <label for="new-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (4 Ø£Ø±Ù‚Ø§Ù…):</label>
                    <input type="password" id="new-password">
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-password" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ -->
    <div id="consumption-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>ğŸ“Š Ø¹Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="consumption-summary" class="data-summary">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                </div>
                <div style="overflow-x: auto;">
                    <table id="consumption-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„ØµÙ†Ù</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹</th>
                            </tr>
                        </thead>
                        <tbody id="consumption-data">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div id="orders-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>ğŸ“‹ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div style="overflow-x: auto;">
                    <table id="orders-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</th>
                                <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>
                                <th>Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</th>
                            </tr>
                        </thead>
                        <tbody id="orders-data">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Supabase
        const SUPABASE_URL = "https://oshbvczwsxpimyneudeg.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zaGJ2Y3p3c3hwaW15bmV1ZGVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3MTA5MjQsImV4cCI6MjA3NDI4NjkyNH0.tzNQ_DCrZLSO2H-EgmtElOlG05__FFmpqU0vJ5ay7VU";

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentUser = null;
        let products = {};
        let availableProducts = {};
        let selectedProducts = [];

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
        });

        function initializeApp() {
            // Ø£Ø­Ø¯Ø§Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('login-btn').addEventListener('click', doLogin);
            document.getElementById('change-password-btn').addEventListener('click', showChangePasswordModal);
            document.getElementById('password').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') doLogin();
            });

            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.getElementById('select-products-btn').addEventListener('click', showProductsModal);
            document.getElementById('consumption-btn').addEventListener('click', showConsumption);
            document.getElementById('orders-btn').addEventListener('click', showMyOrders);
            document.getElementById('send-normal-btn').addEventListener('click', () => sendOrder('Ø¹Ø§Ø¯ÙŠ'));
            document.getElementById('send-cash-btn').addEventListener('click', () => sendOrder('ÙƒØ§Ø´'));

            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª
            setupModalEvents();
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ± Ù…Ù† Ù…Ø¬Ù„Ø¯ img
        function getProductImage(code) {
            const extensions = ['png', 'jpg', 'jpeg', 'webp'];
            let html = '<div class="product-image-container">';

            // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
            extensions.forEach((ext, index) => {
                const displayStyle = index === 0 ? '' : 'style="display:none"';
                html += `<img src="img/${code}.${ext}" 
                             alt="Product ${code}" 
                             class="product-image"
                             ${displayStyle}
                             onerror="handleImageError(this, ${code})"
                             loading="lazy">`;
            });

            html += `<div class="no-image" style="display:none">ğŸ–¼ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</div>`;
            html += '</div>';

            return html;
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·Ø£ Ø§Ù„ØµÙˆØ±Ø©
        function handleImageError(imgElement, code) {
            const container = imgElement.closest('.product-image-container');
            const nextImage = container.querySelector('.product-image:not([style*="display: none"])');
            const noImage = container.querySelector('.no-image');

            imgElement.style.display = 'none';

            if (nextImage) {
                nextImage.style.display = 'block';
            } else {
                noImage.style.display = 'block';
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function doLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            if (!password.match(/^\d{4}$/)) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password);

                if (error) throw error;

                if (data && data.length > 0) {
                    currentUser = username;
                    showMainApp();
                } else {
                    alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                alert('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function showMainApp() {
            document.getElementById('login-page').classList.remove('active');
            document.getElementById('main-page').classList.add('active');
            document.getElementById('welcome-user').textContent = currentUser;

            fetchProductsAndAvailability();
            startAutoRefresh();
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ÙØ±
        async function fetchProductsAndAvailability() {
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
                const { data: pricesData, error: pricesError } = await supabase
                    .from('prices')
                    .select('*');

                if (pricesError) throw pricesError;

                products = {};
                pricesData.forEach(item => {
                    const code = parseInt(item.code);
                    products[code] = {
                        item: item.item,
                        price: parseFloat(item.price) || 0,
                        image_data: item.image_data
                    };
                });

                // Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆØ§ÙØ±
                const { data: availabilityData, error: availabilityError } = await supabase
                    .from('availability')
                    .select('*');

                if (availabilityError) throw availabilityError;

                availableProducts = {};
                availabilityData.forEach(item => {
                    const code = parseInt(item.code);
                    availableProducts[code] = {
                        available: Boolean(item.available),
                        available_qty: parseInt(item.available_qty) || 0
                    };
                });

                updateRefreshTime();
            } catch (error) {
                console.error('Error fetching products:', error);
                alert('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        function updateRefreshTime() {
            const now = new Date().toLocaleTimeString('ar-EG');
            document.getElementById('refresh-status').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${now}`;
        }

        // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoRefresh() {
            setInterval(async () => {
                await fetchProductsAndAvailability();
                checkSystemStatus();
            }, 5000);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        async function checkSystemStatus() {
            try {
                const { data, error } = await supabase
                    .from('system_status')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                const status = data[0] || { buffet_open: true, prayer_closed: false };

                if (!status.buffet_open) {
                    alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø·Ù„Ø¨ ØºØ¯Ù‹Ø§.');
                } else if (status.prayer_closed) {
                    alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡ Ø°Ù‡Ø¨ Ù„Ù„ØµÙ„Ø§Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø©.');
                }
            } catch (error) {
                console.error('Error checking system status:', error);
            }
        }

        // Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        async function showProductsModal() {
            const modal = document.getElementById('products-modal');
            modal.style.display = 'block';
            await loadProductsModal();
        }

        async function loadProductsModal() {
            const productsList = document.getElementById('products-list');
            productsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #ccc;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>';

            try {
                const availableCodes = Object.keys(availableProducts)
                    .filter(code => availableProducts[code].available && availableProducts[code].available_qty > 0)
                    .map(code => parseInt(code));

                const availableProductsList = Object.keys(products)
                    .filter(code => availableCodes.includes(parseInt(code)))
                    .map(code => ({
                        code: parseInt(code),
                        ...products[code]
                    }));

                const drinks = availableProductsList.filter(p => p.code >= 1 && p.code <= 43);
                const foods = availableProductsList.filter(p => p.code >= 100 && p.code <= 135);

                let html = '';

                if (drinks.length > 0) {
                    html += '<h3 style="color: orange; margin: 20px 0 10px 0; font-size: 1.2rem;">ğŸ¥¤ Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h3>';
                    html += renderProductSection(drinks);
                }

                if (foods.length > 0) {
                    html += '<h3 style="color: orange; margin: 20px 0 10px 0; font-size: 1.2rem;">ğŸ” Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª</h3>';
                    html += renderProductSection(foods);
                }

                productsList.innerHTML = html || '<div style="text-align: center; padding: 40px; color: #ccc;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';

                setupProductSearch();

            } catch (error) {
                productsList.innerHTML = '<div style="text-align: center; padding: 40px; color: red;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>';
                console.error('Error loading products:', error);
            }
        }

        function renderProductSection(products) {
            return products.map(product => {
                const availableQty = availableProducts[product.code]?.available_qty || 0;
                const currentQty = selectedProducts.find(p => p.code === product.code)?.qty || 0;

                return `
                    <div class="product-card" data-code="${product.code}">
                        ${getProductImage(product.code)}
                        <div class="product-info">
                            <h4>${product.item}</h4>
                            <p class="price">Ø§Ù„Ø³Ø¹Ø±: ${product.price} Ø¬Ù†ÙŠÙ‡</p>
                            <p style="color: #4ecdc4;">Ø§Ù„Ù…ØªØ§Ø­: ${availableQty}</p>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="decreaseQuantity(${product.code})" 
                                        ${currentQty === 0 ? 'disabled' : ''}>-</button>
                                <span class="quantity-display" id="qty-${product.code}">${currentQty}</span>
                                <button class="quantity-btn" onclick="increaseQuantity(${product.code})"
                                        ${currentQty >= availableQty ? 'disabled' : ''}>+</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª
        function increaseQuantity(code) {
            const availableQty = availableProducts[code]?.available_qty || 0;
            const currentProduct = selectedProducts.find(p => p.code === code);
            const currentQty = currentProduct ? currentProduct.qty : 0;

            if (currentQty < availableQty) {
                if (currentProduct) {
                    currentProduct.qty++;
                } else {
                    selectedProducts.push({
                        code: code,
                        name: products[code].item,
                        price: products[code].price,
                        qty: 1
                    });
                }
                updateQuantityDisplay(code, currentQty + 1);
            }
        }

        function decreaseQuantity(code) {
            const currentProduct = selectedProducts.find(p => p.code === code);
            if (currentProduct) {
                currentProduct.qty--;
                if (currentProduct.qty <= 0) {
                    selectedProducts = selectedProducts.filter(p => p.code !== code);
                }
                updateQuantityDisplay(code, Math.max(0, currentProduct.qty));
            }
        }

        function updateQuantityDisplay(code, quantity) {
            const display = document.getElementById(`qty-${code}`);
            if (display) {
                display.textContent = quantity;
            }
        }

        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        function confirmSelection() {
            if (selectedProducts.length > 0) {
                document.getElementById('selected-products').textContent =
                    `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedProducts.length} Ù…Ù†ØªØ¬ âœ…`;
                document.getElementById('selected-products').style.color = 'lightgreen';
                closeModal('products-modal');
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
            } else {
                alert('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ ÙƒÙ…ÙŠØ§Øª.');
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
        async function sendOrder(orderType) {
            const place = document.getElementById('place').value.trim();
            const note = document.getElementById('note').value.trim();

            if (!place) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙƒØ§Ù†');
                return;
            }

            if (selectedProducts.length === 0 || !selectedProducts.some(p => p.qty > 0)) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            try {
                const { data, error } = await supabase
                    .from('system_status')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                const status = data[0] || { buffet_open: true, prayer_closed: false };

                if (!status.buffet_open) {
                    alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø·Ù„Ø¨ ØºØ¯Ù‹Ø§.');
                    return;
                }

                if (status.prayer_closed) {
                    alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø¨ÙˆÙÙŠÙ‡ Ø°Ù‡Ø¨ Ù„Ù„ØµÙ„Ø§Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø©.');
                    return;
                }
            } catch (error) {
                console.error('Error checking system status:', error);
            }

            try {
                const batchId = `${currentUser}_${Date.now()}`;
                let totalAll = 0;
                const productsData = [];
                const expensesRows = [];

                const now = new Date();
                const nowDate = now.toISOString().split('T')[0];
                const nowTime = now.toTimeString().split(' ')[0];

                for (const prod of selectedProducts) {
                    if (prod.qty <= 0) continue;

                    const code = prod.code;
                    const availableInfo = availableProducts[code];

                    if (!availableInfo || !availableInfo.available) continue;

                    const availableQty = availableInfo.available_qty || 0;
                    let finalQty = prod.qty;

                    if (availableQty < prod.qty) {
                        alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ù† '${prod.name}' Ù‡ÙŠ ${availableQty} ÙÙ‚Ø·.`);
                        finalQty = availableQty;
                        if (finalQty <= 0) continue;
                    }

                    const totalPrice = prod.price * finalQty;
                    totalAll += totalPrice;

                    productsData.push({
                        code: code,
                        item: prod.name,
                        price: prod.price,
                        qty: finalQty,
                        total: totalPrice
                    });

                    expensesRows.push({
                        username: currentUser,
                        code: code,
                        item: prod.name,
                        price: prod.price,
                        qty: finalQty,
                        total: totalPrice,
                        date: nowDate,
                        time: nowTime,
                        payment_type: orderType,
                        batch_id: batchId
                    });

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
                    const newQty = Math.max(0, availableQty - finalQty);
                    await supabase
                        .from('availability')
                        .update({ available_qty: newQty })
                        .eq('code', code);
                }

                if (productsData.length === 0) {
                    alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª ØµØ§Ù„Ø­Ø©');
                    return;
                }

                // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
                await supabase
                    .from('orders')
                    .insert({
                        username: currentUser,
                        place: place,
                        status: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                        order_type: orderType,
                        note: note,
                        batch_id: batchId,
                        products: productsData,
                        total: totalAll,
                        date: nowDate,
                        time: nowTime
                    });

                // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
                await supabase
                    .from('expenses')
                    .insert(expensesRows);

                alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalAll} Ø¬Ù†ÙŠÙ‡`);

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('place').value = '';
                document.getElementById('note').value = '';
                document.getElementById('selected-products').textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬Ø§Øª';
                document.getElementById('selected-products').style.color = 'red';
                selectedProducts = [];

            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + error.message);
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª
        function setupModalEvents() {
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function () {
                    this.closest('.modal').style.display = 'none';
                });
            });

            window.addEventListener('click', function (event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });

            document.getElementById('confirm-selection').addEventListener('click', confirmSelection);
            document.getElementById('save-password').addEventListener('click', changePassword);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function setupProductSearch() {
            const searchInput = document.getElementById('product-search');
            searchInput.addEventListener('input', function () {
                const term = this.value.toLowerCase().trim();
                const productCards = document.querySelectorAll('.product-card');

                productCards.forEach(card => {
                    const productName = card.querySelector('h4').textContent.toLowerCase();
                    if (productName.includes(term)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }

        // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        async function changePassword() {
            const username = document.getElementById('change-username').value.trim();
            const oldPassword = document.getElementById('old-password').value.trim();
            const newPassword = document.getElementById('new-password').value.trim();

            if (!username || !oldPassword || !newPassword) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (!newPassword.match(/^\d{4}$/)) {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('username', username)
                    .eq('password', oldPassword);

                if (error) throw error;

                if (data && data.length > 0) {
                    await supabase
                        .from('users')
                        .update({ password: newPassword })
                        .eq('username', username);

                    alert('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                    closeModal('password-modal');
                } else {
                    alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } catch (error) {
                alert('ÙØ´Ù„ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ' + error.message);
            }
        }

        function showChangePasswordModal() {
            document.getElementById('password-modal').style.display = 'block';
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ - Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
        async function showConsumption() {
            const modal = document.getElementById('consumption-modal');
            modal.style.display = 'block';
            
            try {
                const { data, error } = await supabase
                    .from('expenses')
                    .select('*')
                    .eq('username', currentUser)
                    .order('date', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('consumption-data');
                tbody.innerHTML = '';

                let totalAll = 0;
                let totalCash = 0;
                let totalNormal = 0;

                data.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.date}</td>
                        <td>${expense.item}</td>
                        <td>${expense.qty}</td>
                        <td>${expense.price}</td>
                        <td>${expense.total}</td>
                        <td>${expense.payment_type}</td>
                    `;
                    tbody.appendChild(row);

                    totalAll += parseFloat(expense.total || 0);
                    if (expense.payment_type === 'ÙƒØ§Ø´') {
                        totalCash += parseFloat(expense.total || 0);
                    } else {
                        totalNormal += parseFloat(expense.total || 0);
                    }
                });

                document.getElementById('consumption-summary').innerHTML = 
                    `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${totalAll.toFixed(2)} | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ: ${totalNormal.toFixed(2)} | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒØ§Ø´: ${totalCash.toFixed(2)}`;

            } catch (error) {
                console.error('Error loading consumption data:', error);
                document.getElementById('consumption-summary').innerHTML = 'âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ - Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        async function showMyOrders() {
            const modal = document.getElementById('orders-modal');
            modal.style.display = 'block';
            
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('username', currentUser)
                    .order('id', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('orders-data');
                tbody.innerHTML = '';

                data.forEach(order => {
                    const productsText = Array.isArray(order.products) 
                        ? order.products.map(p => `${p.item} (${p.qty})`).join('<br>')
                        : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª';

                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
                    let duration = '';
                    if (order.time_received && order.time_delivered) {
                        try {
                            const time1 = new Date(`1970-01-01T${order.time_received}`);
                            const time2 = new Date(`1970-01-01T${order.time_delivered}`);
                            const diffMinutes = Math.round((time2 - time1) / (1000 * 60));
                            duration = diffMinutes;
                        } catch (e) {
                            duration = '';
                        }
                    }

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.date}</td>
                        <td>${productsText}</td>
                        <td>${order.total}</td>
                        <td>${order.status}</td>
                        <td>${order.time_received || ''}</td>
                        <td>${order.time_delivered || ''}</td>
                        <td>${duration}</td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading orders data:', error);
                document.getElementById('orders-data').innerHTML = '<tr><td colspan="8" style="text-align: center; color: red;">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            }
        }
    </script>
</body>
</html>

